From d698f63e79ab5831e9fcfb0d2712be8f6bfba725 Mon Sep 17 00:00:00 2001
From: Stefano Pacifici <stefano.pacifici@gmail.com>
Date: Wed, 29 Jul 2020 19:08:26 +0200
Subject: Ghostery custom user agent

---
 app/src/main/java/org/mozilla/fenix/components/Core.kt | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/app/src/main/java/org/mozilla/fenix/components/Core.kt b/app/src/main/java/org/mozilla/fenix/components/Core.kt
index e41ce19a2..81b4ddf83 100644
--- a/app/src/main/java/org/mozilla/fenix/components/Core.kt
+++ b/app/src/main/java/org/mozilla/fenix/components/Core.kt
@@ -58,6 +58,7 @@ import org.mozilla.fenix.media.MediaService
 import org.mozilla.fenix.search.telemetry.ads.AdsTelemetry
 import org.mozilla.fenix.search.telemetry.incontent.InContentTelemetry
 import org.mozilla.fenix.utils.Mockable
+import org.mozilla.geckoview.GeckoSession
 import java.util.concurrent.TimeUnit
 
 /**
@@ -70,6 +71,10 @@ class Core(private val context: Context) {
      * configuration (see build variants).
      */
     val engine: Engine by lazy {
+        /* Ghostery Begin: override user-agent */
+        val defaultUserAgent = GeckoSession.getDefaultUserAgent()
+        val (prefix, postfix) = defaultUserAgent.split(')')
+        val customUserAgent = "$prefix; Ghostery:3.0)$postfix"
         val defaultSettings = DefaultSettings(
             requestInterceptor = AppRequestInterceptor(context),
             remoteDebuggingEnabled = context.settings().isRemoteDebuggingEnabled,
@@ -81,8 +86,10 @@ class Core(private val context: Context) {
             fontInflationEnabled = context.settings().shouldUseAutoSize,
             suspendMediaWhenInactive = false,
             forceUserScalableContent = context.settings().forceEnableZoom,
-            loginAutofillEnabled = context.settings().shouldAutofillLogins
+            loginAutofillEnabled = context.settings().shouldAutofillLogins,
+            userAgentString = customUserAgent
         )
+        /* Ghostery End */
 
         GeckoEngine(
             context,
-- 
2.25.1

