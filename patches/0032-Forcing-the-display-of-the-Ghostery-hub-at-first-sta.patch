From c1cf3e683002d5d6c635477bb778f2afa641339f Mon Sep 17 00:00:00 2001
From: Stefano Pacifici <stefano.pacifici@gmail.com>
Date: Thu, 23 Jul 2020 17:00:11 +0200
Subject: Forcing the display of the Ghostery hub at first startup

---
 .../main/java/org/mozilla/fenix/HomeActivity.kt  | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/app/src/main/java/org/mozilla/fenix/HomeActivity.kt b/app/src/main/java/org/mozilla/fenix/HomeActivity.kt
index d0fd31e50..0793dee94 100644
--- a/app/src/main/java/org/mozilla/fenix/HomeActivity.kt
+++ b/app/src/main/java/org/mozilla/fenix/HomeActivity.kt
@@ -230,6 +230,22 @@ open class HomeActivity : LocaleAwareAppCompatActivity() {
             }
         }
         /* Ghostery End */
+
+        /* Ghostery Begin: on-boarding */
+        // This is an hack to force the browser to display the extension on-boarding on start-up
+        val hubPattern = """moz-extension://[^/]+/app/templates/hub\.html.*""".toRegex()
+        components.core.sessionManager.register(
+            owner = this,
+            observer = object : SessionManager.Observer {
+                override fun onSessionSelected(session: Session) {
+                    if (hubPattern.matches(session.url) &&
+                                navHost.navController.currentDestination?.id != R.id.browserFragment ) {
+                        navHost.navController.navigate(R.id.browserFragment)
+                    }
+                }
+            }
+        )
+        /* Ghostery End */
     }
 
     final override fun onPause() {
-- 
2.25.1

